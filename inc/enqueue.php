<?php
/**
 * Twenty'em WordPress Framework.
 *
 * WARNING: This file is part of Twenty'em WordPress Framework.
 * DO NOT edit this file under any circumstances. Do all your modifications in the form of a child theme.
 *
 * @package			WordPress
 * @subpackage		Twenty'em
 * @author			RogerTM
 * @license			license.txt
 * @link			https://themingisprose.com/twenty-em
 * @since 			Twenty'em 1.0
 */

/**
 * Twenty'em register scripts and styles.
 *
 * @link http://codex.wordpress.org/Plugin_API/Action_Reference/wp_register_script
 */

/**
 * Register Style Sheet and Javascript to beautify the Twenty'em theme
 */
function t_em_enqueue_styles_and_scripts(){
	global $t_em, $t_em_theme_data;

	// Load default style sheet style.css
	wp_enqueue_style( 'style-t-em', get_stylesheet_uri(), '', $t_em_theme_data['Version'], 'all' );

	/**
	 * Adds JavaScript to pages with the comment form to support
	 * sites with threaded comments (when in use).
	 */
	if ( is_singular() && comments_open() && get_option( 'thread_comments' ) ) :
		wp_enqueue_script( 'comment-reply' );
	endif;

	// Load the html5 shiv.
	wp_enqueue_script( 'html5-shiv', t_em_get_js( 'html5' ), array(), $t_em_theme_data['Version'] );
	wp_script_add_data( 'html5-shiv', 'conditional', 'lt IE 9' );

	// Register Carousel Bootstrap Plugins when needed
	if ( 'slider' == $t_em['header_set'] ) :
		t_em_register_bootstrap_plugin( 'carousel' );
	endif;

	// Register Collapse Bootstrap Plugins when needed
	if ( has_nav_menu( 'top-menu' ) || has_nav_menu( 'navigation-menu' ) ) :
		t_em_register_bootstrap_plugin( 'collapse' );
		t_em_register_bootstrap_plugin( 'popper' );
		t_em_register_bootstrap_plugin( 'dropdown' );
	endif;

	// Countdown jQuery plugin for Maintenance Mode
	$nonce = ( isset( $_GET['maintenance-mode'] ) ) ? $_GET['maintenance-mode'] : null;
	// Check if the current user can see the site
	$current_user = wp_get_current_user();
	$user_can = array_intersect( t_em_maintenance_mode_role_active(), $current_user->roles );
	if ( $t_em['maintenance_mode'] == 1 && (
				! is_user_logged_in() ||
				empty( $user_can ) ||
				( isset( $_GET['maintenance-mode'] ) && wp_verify_nonce( $nonce, 'maintenance_mode' ) )
			) ) :
		wp_register_script( 'countdown', t_em_get_js( 'jquery.countdown' ), array( 'jquery' ), $t_em_theme_data['Version'] );
		wp_enqueue_script( 'countdown' );
	endif;

	wp_register_script( 'app-utils', t_em_get_js( 'app.utils' ), array( 'jquery' ), $t_em_theme_data['Version'] );
	wp_enqueue_script( 'app-utils' );
}
add_action( 'wp_enqueue_scripts', 't_em_enqueue_styles_and_scripts' );

/**
 * The Head tags
 */
function t_em_head(){
?>
	<meta charset="<?php bloginfo( 'charset' ); ?>">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<?php
	if ( is_singular() && pings_open() ) {
		printf( '<link rel="pingback" href="%s">' . "\n", get_bloginfo( 'pingback_url' ) );
	}
}
add_action( 'wp_head', 't_em_head' );
?>
