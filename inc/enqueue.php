<?php
/**
 * Twenty'em WordPress Framework.
 *
 * WARNING: This file is part of Twenty'em WordPress Framework.
 * DO NOT edit this file under any circumstances. Do all your modifications in the form of a child theme.
 *
 * @package			WordPress
 * @subpackage		Twenty'em
 * @author			RogerTM
 * @license			license.txt
 * @link			https://themingisprose.com/twenty-em
 * @since 			Twenty'em 1.0
 */

/**
 * Twenty'em register scripts and styles.
 *
 * @link http://codex.wordpress.org/Plugin_API/Action_Reference/wp_register_script
 */

/**
 * Register Style Sheet and Javascript to beautify the Twenty'em theme
 */
function t_em_enqueue_styles_and_scripts(){
	// Dequeue old jQuery
	wp_deregister_script('jquery');
	// Enqueue jQuery 3.+ to support Bootstrap jQuery plugins
	wp_register_script( 'jquery', t_em_get_js( 'jquery', T_EM_THEME_DIR_JQUERY_PATH .'/dist', T_EM_THEME_DIR_JQUERY_URL .'/dist' ), array(), t_em_theme( 'Version' ), true );
	wp_enqueue_script( 'jquery' );

	// Load default style sheet style.css
	wp_register_style( 'twenty-em-style', t_em_get_css( 'theme' ), '', t_em_theme( 'Version' ), 'all' );
	wp_enqueue_style( 'twenty-em-style' );

	/**
	 * Adds JavaScript to pages with the comment form to support
	 * sites with threaded comments (when in use).
	 */
	if ( is_singular() && comments_open() && get_option( 'thread_comments' ) ) :
		wp_enqueue_script( 'comment-reply' );
	endif;

	// Register Bootstrap JS
	/**
	 * Filter if call the entire compiled JavaScripts plugins from Bootstrap or not. If not, you must
	 * call each plugin when needed using the t_em_register_bootstrap_plugin() function.
	 * @param bool 		Default true.
	 *
	 * @since Twenty'em 1.3.0
	 */
	if ( apply_filters( 't_em_filter_bootstrap_js', true ) ) :
		wp_register_script( 'bootstrap', t_em_get_js( 'bootstrap.bundle', T_EM_THEME_DIR_BOOTSTRAP_PATH .'/dist/js/', T_EM_THEME_DIR_BOOTSTRAP_URL .'/dist/js/' ), array( 'jquery' ), t_em_theme( 'Version' ), true );
		wp_enqueue_script( 'bootstrap' );
	endif;

	// Countdown jQuery plugin for Maintenance Mode
	$nonce = ( isset( $_GET['maintenance-mode'] ) ) ? $_GET['maintenance-mode'] : null;
	// Check if the current user can see the site
	$current_user = wp_get_current_user();
	$user_can = array_intersect( t_em_maintenance_mode_role_active(), $current_user->roles );
	if ( t_em( 'maintenance_mode' ) == 1 && (
				! is_user_logged_in() ||
				empty( $user_can ) ||
				( isset( $_GET['maintenance-mode'] ) && wp_verify_nonce( $nonce, 'maintenance_mode' ) )
			) ) :
		if ( t_em( 'maintenance_mode_timer' ) ) :
			wp_register_script( 'countdown', t_em_get_js( 'jQuery.countdownTimer', T_EM_THEME_DIR_COUNTDOWN_TIMER_PATH .'/dist/js', T_EM_THEME_DIR_COUNTDOWN_TIMER_URL .'/dist/js' ), array( 'jquery' ), t_em_theme( 'Version' ), true );
			wp_enqueue_script( 'countdown' );
			if ( get_option( 'WPLANG' ) == 'es_ES' ) :
				wp_register_script( 'countdown-es', t_em_get_js( 'jQuery.countdownTimer-es', T_EM_THEME_DIR_COUNTDOWN_TIMER_PATH .'/dist/js/localisation', T_EM_THEME_DIR_COUNTDOWN_TIMER_URL .'/dist/js/localisation' ), array( 'jquery' ), t_em_theme( 'Version' ), true );
				wp_enqueue_script( 'countdown-es' );
			endif;
		endif;
	endif;

	wp_register_script( 'app-utils', t_em_get_js( 'app.utils' ), array( 'jquery' ), t_em_theme( 'Version' ), true );
	// l10n for app.utils.js
	$translation = array(
		'maintenanceMode'	=> t_em( 'maintenance_mode' ) /*&& $nonce*/ ? true : null,
		'countdownTimer'	=> t_em( 'maintenance_mode_timer' ),
	);
	wp_localize_script( 'app-utils', 't_em_l10n', $translation );
	wp_enqueue_script( 'app-utils' );
}
add_action( 'wp_enqueue_scripts', 't_em_enqueue_styles_and_scripts' );

/**
 * The Head tags
 */
function t_em_head(){
?>
	<meta charset="<?php bloginfo( 'charset' ); ?>">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<?php
	if ( is_singular() && pings_open() ) {
		printf( '<link rel="pingback" href="%s">' . "\n", get_bloginfo( 'pingback_url' ) );
	}
}
add_action( 'wp_head', 't_em_head' );
?>
